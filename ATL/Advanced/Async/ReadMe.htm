<!--要阅读此帮助文件，请在解决方案资源管理器窗格中右击文件名，
    然后选择"在浏览器中查看"。-->

<html><head><title>ASYNC 示例：异步下载数据</title></head><body><h1>ASYNC 示例：异步下载数据</h1><div id="mainSection"><div id="mainBody"><div id="allHistory" class="saveHistory" onsave="saveAll()" onload="loadAll()"></div><p /><p>ASYNC 示例创建一个从 URL 异步下载数据的控件。 该控件实现 <b>IBindStatusCallback</b> 接口。 对于很大的二进制对象或属性通常都采用异步下载的方式。 这样可使控件的用户界面在可能的长时间的网络操作中保持不被阻塞。 使用异步下载还使用户有机会中止下载。 ATL 在内部使用 WinInet 函数实现异步下载。</p><p>ASYNC 特性示例是此示例的特性化版本。</p><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left">安全说明 </th></tr><tr><td><p>提供此代码示例是为了阐释一个概念，它并不代表最安全的编码实践，因此不应在应用程序或网站中使用此代码示例。</p></td></tr></table></div><h1 class="heading">生成并运行示例</h1><div id="sectionSection0" class="seeAlsoNoToggleSection"><h4 class="subHeading">生成并运行此示例</h4><div class="subSection"><ol><li><p>打开解决方案文件 async.sln。</p></li><li><p>在<b>“生成”</b>菜单中，单击<b>“生成解决方案”</b>。</p></li><li><p>示例生成后，在 Web 浏览器中打开 ATLAsync.htm，并按照其说明进行操作。 这将设置 ASYNC 控件的 <b>URL</b> 属性并开始下载。 在数据下载过程中，您会看到数据在 ASYNC 控件中显示。</p></li></ol></div><p>可以在 ActiveX 控件测试容器中测试控件。 有关访问测试容器和用它来测试控件的详细信息，请参见<MSHelp:link keywords="626867CF-FE53-4C30-8973-55BB93EF3917" tabindex="0" >用测试容器测试属性和事件</MSHelp:link>。</p></div><h1 class="heading">示例的工作机制</h1><div id="sectionSection1" class="seeAlsoNoToggleSection"><p>ASYNC 使用一个名为 <b>URL</b> 的属性创建子类编辑控件。 <b>URL</b> 属性是表示指向数据的 URL 的 <b>BSTR</b>。 ASYNC 示例使用 ATL <b>CBindStatusCallback</b> 类实现异步下载。 当控件用户设置 URL 属性时，ASYNC 创建 <b>CBindStatusCallback</b> 对象。 然后调用 <b>CBindStatusCallback::StartAsyncDownload</b> 方法，并向它传递该 URL 和指向回调函数的指针。 此函数（即 <b>CAtlAsync::OnData</b>）由 <b>CBindStatusCallback</b> 对象调用，在收到 URL 时，会向它传递 URL 中的二进制数据。 <b>CAtlAsync::OnData</b> 只是将收到的数据发送到子类编辑控件 (Edit Control)，并在那里显示该数据。</p><p>有关如何使用 ATL 为 Windows 控件创建超类的示例，请参见 ATL SUBEDIT 示例。</p></div><h1 class="heading">关键字</h1><div id="sectionSection2" class="seeAlsoNoToggleSection"><p>此示例使用以下关键字：</p><p>ALT_MSG_MAP; ATLTRACE ; BEGIN_COM_MAP; BEGIN_MSG_MAP; BEGIN_OBJECT_MAP; BEGIN_PROPERTY_MAP; CBindStatusCallback::Download; CComBSTR::Append; CComCoClass; CComControl; CComModule::GetClassObject; CComModule::GetLockCount; CComModule::Init; CComModule::RegisterServer; CComModule::Term; CComModule::UnregisterServer; CComObjectRoot; COM_INTERFACE_ENTRY; COM_INTERFACE_ENTRY_IMPL; DECLARE_REGISTRY_RESOURCEID; DisableThreadLibraryCalls; DLL_PROCESS_ATTACH; DLL_PROCESS_DETACH; DllMain; END_COM_MAP; END_MSG_MAP; END_OBJECT_MAP; END_PROPERTY_MAP; IDataObjectImpl; IDispatchImpl; IOleControlImpl; IOleInPlaceActiveObjectImpl; IOleInPlaceObjectWindowlessImpl; IOleInPlaceObjectWindowlessImpl::SetObjectRects; IOleObjectImpl; IPerPropertyBrowsingImpl; IPersistPropertyBagImpl; IPersistStorageImpl; IPersistStreamInitImpl; IProvideClassInfo2Impl; IQuickActivateImpl; IsWindow; IViewObjectExImpl; MESSAGE_HANDLER; OBJECT_ENTRY; PROP_ENTRY; SendMessage; USES_CONVERSION</p></div></div><div id="footer"><div class="footerLine"></div>
          © Microsoft Corporation。 保留所有权利。  请将有关此主题的<a href="mailto:DevDocs@microsoft.com?subject=Documentation Feedback :ASYNC Sample: Downloads Data Asynchronously">评论</a>发送给 Microsoft。
      </div></div></body></html>

